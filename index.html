<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Cash Memo</title>
    <!-- ‡¶´‡¶®‡ßç‡¶ü -->
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- ‡¶≤‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∞‡¶ø -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        /* ‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        body {
            font-family: 'Hind Siliguri', 'Roboto', sans-serif;
            background-color: #e0e0e0;
            margin: 0;
            padding: 10px;
            padding-bottom: 80px;
        }

        /* ---- ‡¶≠‡¶æ‡¶∑‡¶æ ‡¶¨‡¶æ‡¶ü‡¶® ---- */
        .lang-bar { display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 10px; }
        .lang-btn { padding: 6px 15px; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); color: white; }
        .btn-bn { background: #00796b; }
        .btn-en { background: #d32f2f; }

        /* ---- ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ---- */
        .slider-container {
            width: 100%; height: 160px; overflow: hidden; border-radius: 8px;
            margin-bottom: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); position: relative; background: #fff;
        }
        .slider-wrapper { display: flex; width: 100%; height: 100%; transition: transform 0.5s ease-in-out; }
        .slide-img { min-width: 100%; height: 100%; object-fit: cover; display: block; }

        /* ---- ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ---- */
        .dashboard {
            background: #fff; padding: 10px; border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); margin-bottom: 15px;
            border-top: 4px solid #d32f2f;
        }
        .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-weight: bold; color: #333; }
        
        #inputForm, #bannerForm { display: none; background: #f1f5f9; padding: 10px; border-radius: 5px; margin-bottom: 10px; border: 1px solid #ddd; }
        .row { display: flex; gap: 5px; margin-bottom: 5px; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-family: inherit; font-weight: 600; }

        /* ‡¶¨‡¶æ‡¶ü‡¶® */
        .btn-main { background: #007bff; color: white; padding: 10px; width: 100%; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; margin-bottom: 5px; }
        .btn-save { background: #28a745; color: white; border: none; padding: 8px; border-radius: 4px; width: 100%; cursor: pointer; }
        .btn-view { background: #17a2b8; color: white; padding: 10px; width: 100%; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; margin-bottom: 5px; }
        .btn-banner { background: #6610f2; color: white; padding: 10px; width: 100%; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; margin-bottom: 10px; }

        /* ‡¶ó‡ßç‡¶∞‡¶ø‡¶° (‡¶∏‡ßã‡¶®‡¶æ‡¶≤‡ßÄ) */
        .grid-box { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; margin-top: 10px; }
        .item-box {
            background: linear-gradient(135deg, #ffd700 0%, #ffb300 100%);
            color: #000; padding: 15px 5px; border-radius: 8px; text-align: center;
            cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.3); position: relative;
            border: 1px solid #eec000;
        }
        .item-box:active { transform: scale(0.95); }
        .item-name { display: block; font-size: 20px; font-weight: 800; margin-bottom: 5px; }
        .item-price { font-size: 15px; font-weight: bold; background: rgba(255,255,255,0.4); padding: 2px 8px; border-radius: 10px; }
        .del-badge { position: absolute; top: -8px; right: -8px; background: red; color: white; width: 20px; height: 20px; border-radius: 50%; font-size: 12px; line-height: 20px; display: none; border: 2px solid white; }

        #savedListArea { display: none; margin-top: 10px; border-top: 1px dashed #ccc; padding-top: 10px; }
        .saved-item { background: #f8f9fa; border: 1px solid #bbb; padding: 10px; margin-bottom: 8px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; font-size: 13px; }

        /* ---- ‡¶Æ‡ßá‡¶Æ‡ßã ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ---- */
        .paper {
            background: #fff; max-width: 100%; margin: 0 auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); border: 1px solid #888;
            position: relative; padding-bottom: 20px;
        }

        .memo-header { background: linear-gradient(to bottom, #fffde7, #fff9c4); padding: 15px; text-align: center; border-bottom: 3px solid #fbc02d; }
        .bismillah { font-size: 12px; color: #000; margin-bottom: 5px; }
        .title-head { font-size: 28px; font-weight: 800; color: #d32f2f; text-shadow: 1px 1px 0px #fff; margin: 5px 0; line-height: 1.2; }
        .prop-box { background: #2e7d32; color: white; padding: 2px 15px; border-radius: 15px; font-size: 12px; display: inline-block; margin-bottom: 5px; }
        .address-strip { background: #fdd835; color: black; width: 100%; padding: 3px 0; font-weight: bold; font-size: 13px; margin-top: 5px; }

        .info-sec { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #ddd; background: #fff; font-size: 13px; font-weight: bold;}
        .cust-line { padding: 0 10px 10px 10px; display: flex; align-items: center; }
        .cust-input { border: none; border-bottom: 1px dotted #000; width: 100%; outline: none; font-weight: bold; font-family: inherit; font-size: 14px; margin-left: 5px; }

        table { width: 100%; border-collapse: collapse; margin-top: 5px; }
        th { background-color: #c2185b; color: white; padding: 6px; font-size: 13px; border: 1px solid #880e4f; text-align: center; }
        td { border: 1px solid #888; padding: 6px; text-align: center; font-size: 13px; color: black; font-weight: 600; }

        .col-desc { background-color: #fffde7; text-align: left !important; padding-left: 5px !important; }
        .col-qty { background-color: #fce4ec; } .col-rate { background-color: #e3f2fd; } .col-total { background-color: #e0f2f1; }

        .footer-area { display: flex; justify-content: space-between; padding: 15px; align-items: flex-end; }
        .words-area { width: 55%; font-size: 12px; border-bottom: 1px dotted #000; margin-bottom: 20px; }
        
        .calc-table { width: 40%; border-collapse: collapse; }
        .calc-table td { padding: 4px; font-weight: bold; font-size: 13px; border: 1px solid #888; }
        
        .bg-blue { background: #1976d2; color: white; text-align: center; }
        .bg-pink { background: #d81b60; color: white; text-align: center; }
        .bg-green { background: #388e3c; color: white; text-align: center; }
        .amount-box { background: #fff; text-align: right; padding-right: 5px; }
        .footer-input { width: 100%; border: none; background: transparent; text-align: right; font-weight: bold; font-size: 14px; outline: none; color: #000; }

        .sign-area { text-align: center; margin-top: 20px; position: relative; width: 120px; margin-left: auto; margin-right: 10px; }
        #signCanvas { width: 100%; height: 50px; cursor: crosshair; display: block; background: transparent; }
        .sign-line { border-top: 2px solid #000; display: block; width: 100%; margin-top: -5px; font-size: 12px; font-weight: bold; padding-top: 5px; }
        .clear-sign-btn { position: absolute; top: -10px; right: -10px; background: red; color: white; width: 18px; height: 18px; border-radius: 50%; font-size: 12px; line-height: 18px; text-align: center; cursor: pointer; border: 1px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }

        .bottom-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; display: flex; padding: 10px; box-shadow: 0 -2px 10px rgba(0,0,0,0.2); gap: 5px; z-index: 999; }
        .btn-web { flex: 1; background: #ff9800; color: white; padding: 10px 5px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 11px; }
        .btn-p { flex: 1; background: #6f42c1; color: white; padding: 10px 5px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 11px; }
        .btn-pdf { flex: 1; background: #00897b; color: white; padding: 10px 5px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 11px; }
        .btn-n { flex: 1; background: #dc3545; color: white; padding: 10px 5px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 11px; }

        @media print {
            body { background: white; padding: 0; }
            .dashboard, .bottom-bar, .lang-bar, .del-badge, .slider-container, .data-html2canvas-ignore, .clear-sign-btn { display: none !important; }
            .paper { box-shadow: none; border: none; padding: 0; margin: 0; width: 100%; }
        }
    </style>
</head>
<body>

    <!-- ‡¶≠‡¶æ‡¶∑‡¶æ ‡¶¨‡¶æ‡¶ü‡¶® -->
    <div class="lang-bar data-html2canvas-ignore">
        <button class="lang-btn btn-bn" onclick="setLang('bn')">üáßüá© ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</button>
        <button class="lang-btn btn-en" onclick="setLang('en')">üá∫üá∏ English</button>
    </div>

    <!-- ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ -->
    <div class="slider-container data-html2canvas-ignore">
        <div class="slider-wrapper" id="sliderWrapper">
            <img src="" class="slide-img" id="slide1" alt="Banner 1">
            <img src="" class="slide-img" id="slide2" alt="Banner 2">
            <img src="" class="slide-img" id="slide3" alt="Banner 3">
        </div>
    </div>

    <!-- ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° -->
    <div class="dashboard data-html2canvas-ignore">
        <div class="panel-header">
            <span id="txtPanelTitle">‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶Æ‡ßá‡¶Æ‡ßã</span>
            <span style="color:red; font-size:12px; text-decoration:underline; cursor:pointer;" onclick="toggleDel()" id="txtDelMode">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶Æ‡ßã‡¶°</span>
        </div>
        
        <button class="btn-banner" onclick="toggleBannerForm()" id="btnBannerSet">üñºÔ∏è ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç</button>
        <div id="bannerForm">
            <h4 style="margin-top:0; text-align:center;" id="txtBannerHead">‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¨‡¶∏‡¶æ‡¶®</h4>
            <div style="display:flex; flex-direction:column; gap:5px;">
                <input type="text" id="url1" placeholder="Link 1...">
                <input type="text" id="url2" placeholder="Link 2...">
                <input type="text" id="url3" placeholder="Link 3...">
                <button class="btn-save" onclick="saveBanners()" id="btnSaveBanner">‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>

        <button class="btn-view" onclick="toggleSavedList()" id="btnViewList">üìú ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶Æ‡ßá‡¶Æ‡ßã ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
        <div id="savedListArea">
            <div id="historyContainer"></div>
        </div>

        <button class="btn-main" onclick="openForm()" id="btnAddProd"> + ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <div id="inputForm">
            <div class="row">
                <input type="text" id="dbName" placeholder="‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
                <select id="dbUnit">
                    <!-- Options populated by JS -->
                </select>
            </div>
            <div class="row">
                <input type="number" id="dbPrice" placeholder="‡¶¶‡¶æ‡¶Æ">
                <button class="btn-save" onclick="saveData()" id="btnSaveDB">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
            <small style="color:#666; font-size:11px;" id="txtNote">* ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ/‡¶Æ‡¶ø‡¶≤‡¶ø ‡¶π‡¶≤‡ßá ‡ßß ‡¶ï‡ßá‡¶ú‡¶ø/‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶è‡¶∞ ‡¶¶‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§</small>
        </div>

        <div class="grid-box" id="gridArea"></div>
    </div>

    <!-- ‡¶Æ‡ßá‡¶Æ‡ßã ‡¶™‡ßá‡¶™‡¶æ‡¶∞ -->
    <div class="paper" id="printArea">
        <div class="memo-header">
            <div class="bismillah" id="txtBism">‡¶¨‡¶ø‡¶∏‡¶Æ‡¶ø‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶ø‡¶∞ ‡¶∞‡¶æ‡¶π‡¶Æ‡¶æ‡¶®‡¶ø‡¶∞ ‡¶∞‡¶æ‡¶π‡¶ø‡¶Æ</div>
            <div class="title-head" contenteditable="true" id="txtShopName">‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶Æ‡ßá‡¶Æ‡ßã</div>
            <div class="prop-box" contenteditable="true" id="txtProp">‡¶™‡ßç‡¶∞‡ßã‡¶É ‡¶Æ‡ßã‡¶É ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</div>
            <div class="address-strip" contenteditable="true" id="txtAddr">‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ: ‡¶ï‡¶≤‡ßá‡¶ú ‡¶∞‡ßã‡¶°, ‡¶¢‡¶æ‡¶ï‡¶æ</div>
        </div>

        <div class="info-sec">
            <span><span id="lblMemoNo">‡¶Æ‡ßá‡¶Æ‡ßã ‡¶®‡¶Ç</span>: <span id="mNo"></span></span>
            <span><span id="lblDate">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</span>: <span id="mDate"></span></span>
        </div>
        <div class="cust-line">
            <span id="lblCustName">‡¶®‡¶æ‡¶Æ:</span>
            <input type="text" class="cust-input" id="inpCustName" placeholder="‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ...">
        </div>

        <table>
            <thead>
                <tr>
                    <th width="40%" id="thDesc">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
                    <th width="15%" id="thQty">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                    <th width="15%" id="thUnit">‡¶è‡¶ï‡¶ï</th>
                    <th width="15%" id="thRate">‡¶¶‡¶∞</th>
                    <th width="15%" id="thTotal">‡¶ü‡¶æ‡¶ï‡¶æ</th>
                </tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>

        <div class="footer-area">
            <div style="width:55%">
                <div class="words-area"><span id="lblWords">‡¶ï‡¶•‡¶æ‡ßü</span>: <span id="inWords"></span></div>
                <div class="sign-area">
                    <canvas id="signCanvas" width="120" height="50"></canvas>
                    <div class="clear-sign-btn data-html2canvas-ignore" onclick="clearSignature()">X</div>
                    <div class="sign-line" id="lblSign">‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</div>
                </div>
            </div>

            <table class="calc-table">
                <tr>
                    <td class="bg-blue" id="lblTotal">‡¶Æ‡ßã‡¶ü</td>
                    <td class="amount-box" id="grandTotal">0.00</td>
                </tr>
                <tr>
                    <td class="bg-pink" id="lblPaid">‡¶ú‡¶Æ‡¶æ</td>
                    <td class="amount-box">
                        <input type="number" id="tablePaid" class="footer-input" placeholder="">
                    </td>
                </tr>
                <tr>
                    <td class="bg-green" id="lblDue">‡¶¨‡¶æ‡¶ï‡¶ø</td>
                    <td class="amount-box">
                        <input type="number" id="tableDue" class="footer-input" placeholder="">
                    </td>
                </tr>
            </table>
        </div>
        
        <div style="text-align:center; font-size:11px; margin-bottom:5px; font-style:italic;" id="txtFooterMsg">* ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶§ ‡¶Æ‡¶æ‡¶≤ ‡¶´‡ßá‡¶∞‡¶§ ‡¶®‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü ‡¶®‡¶æ *</div>
    </div>

    <!-- ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡¶æ‡¶∞ -->
    <div class="bottom-bar data-html2canvas-ignore">
        <button class="btn-web" onclick="saveToWebsite()" id="btnWeb">‡¶∏‡ßá‡¶≠ (Web)</button>
        <button class="btn-p" onclick="downloadImage()" id="btnGal">‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø</button>
        <button class="btn-pdf" onclick="downloadPDF()">PDF</button>
        <button class="btn-n" onclick="resetMemo()" id="btnNew">‡¶®‡¶§‡ßÅ‡¶®</button>
    </div>

    <script>
        // ---- ‡¶≠‡¶æ‡¶∑‡¶æ ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ----
        let currentLang = 'bn';
        
        const langData = {
            bn: {
                panelTitle: '‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶Æ‡ßá‡¶Æ‡ßã', delMode: '‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶Æ‡ßã‡¶°', bannerSet: 'üñºÔ∏è ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç', bannerHead: '‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¨‡¶∏‡¶æ‡¶®',
                saveBanner: '‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®', viewList: 'üìú ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶Æ‡ßá‡¶Æ‡ßã ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®', addProd: '+ ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®',
                prodPh: '‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ', pricePh: '‡¶¶‡¶æ‡¶Æ (‡¶¶‡¶∞)', saveDB: '‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®',
                note: '* ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ/‡¶Æ‡¶ø‡¶≤‡¶ø ‡¶π‡¶≤‡ßá ‡ßß ‡¶ï‡ßá‡¶ú‡¶ø ‡¶¨‡¶æ ‡ßß ‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¶‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§',
                bism: '‡¶¨‡¶ø‡¶∏‡¶Æ‡¶ø‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶ø‡¶∞ ‡¶∞‡¶æ‡¶π‡¶Æ‡¶æ‡¶®‡¶ø‡¶∞ ‡¶∞‡¶æ‡¶π‡¶ø‡¶Æ', shopName: '‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶Æ‡ßá‡¶Æ‡ßã', prop: '‡¶™‡ßç‡¶∞‡ßã‡¶É ‡¶Æ‡ßã‡¶É ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ', addr: '‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ: ‡¶ï‡¶≤‡ßá‡¶ú ‡¶∞‡ßã‡¶°, ‡¶¢‡¶æ‡¶ï‡¶æ',
                memoNo: '‡¶Æ‡ßá‡¶Æ‡ßã ‡¶®‡¶Ç', date: '‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ', custName: '‡¶®‡¶æ‡¶Æ:', custPh: '‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ...',
                desc: '‡¶¨‡¶ø‡¶¨‡¶∞‡¶£', qty: '‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£', unit: '‡¶è‡¶ï‡¶ï', rate: '‡¶¶‡¶∞', total: '‡¶ü‡¶æ‡¶ï‡¶æ',
                words: '‡¶ï‡¶•‡¶æ‡ßü', sign: '‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞', totalLbl: '‡¶Æ‡ßã‡¶ü', paid: '‡¶ú‡¶Æ‡¶æ', due: '‡¶¨‡¶æ‡¶ï‡¶ø',
                footerMsg: '* ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶§ ‡¶Æ‡¶æ‡¶≤ ‡¶´‡ßá‡¶∞‡¶§ ‡¶®‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü ‡¶®‡¶æ *',
                btnWeb: '‡¶∏‡ßá‡¶≠ (Web)', btnGal: '‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø', btnNew: '‡¶®‡¶§‡ßÅ‡¶®',
                confirmDel: '‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?', promptQty: '‡¶ï‡¶§‡¶ü‡ßÅ‡¶ï‡ßÅ?', alertEmpty: '‡¶Æ‡ßá‡¶Æ‡ßã ‡¶ñ‡¶æ‡¶≤‡¶ø!', alertSave: '‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!',
                units: ["‡¶ï‡ßá‡¶ú‡¶ø", "‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ", "‡¶Æ‡¶ø‡¶≤‡¶ø", "‡¶™‡¶ø‡¶∏", "‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞", "‡¶°‡¶ú‡¶®", "‡¶π‡¶æ‡¶≤‡¶ø", "‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ü", "‡¶¨‡¶ï‡ßç‡¶∏"]
            },
            en: {
                panelTitle: 'cash memo', delMode: 'Delete Mode', bannerSet: 'üñºÔ∏è Banner Settings', bannerHead: 'Enter Image Links',
                saveBanner: 'Save Banners', viewList: 'üìú View Saved Memos', addProd: '+ Add Product',
                prodPh: 'Product Name', pricePh: 'Price (Rate)', saveDB: 'Save',
                note: '* For Gram/ML, enter price of 1 KG or 1 Liter.',
                bism: 'Bismillahir Rahmanir Rahim', shopName: 'CASH MEMO HEADLINE', prop: 'Prop: Md. Your Name', addr: 'Address: College Road, Dhaka',
                memoNo: 'Memo No', date: 'Date', custName: 'Name:', custPh: 'Customer Name...',
                desc: 'Description', qty: 'Qty', unit: 'Unit', rate: 'Rate', total: 'Amount',
                words: 'In Words', sign: 'Signature', totalLbl: 'Total', paid: 'Paid', due: 'Due',
                footerMsg: '* Goods once sold are not returnable *',
                btnWeb: 'Save (Web)', btnGal: 'Gallery', btnNew: 'New',
                confirmDel: 'Delete this?', promptQty: 'Quantity?', alertEmpty: 'Memo is empty!', alertSave: 'Saved Successfully!',
                units: ["Kg", "Gm", "Ml", "Pcs", "Ltr", "Dzn", "Hali", "Pkt", "Box"]
            }
        };

        function setLang(lang) {
            currentLang = lang;
            const t = langData[lang];

            // ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°
            document.getElementById('txtPanelTitle').innerText = t.panelTitle;
            document.getElementById('txtDelMode').innerText = t.delMode;
            document.getElementById('btnBannerSet').innerText = t.bannerSet;
            document.getElementById('txtBannerHead').innerText = t.bannerHead;
            document.getElementById('btnSaveBanner').innerText = t.saveBanner;
            document.getElementById('btnViewList').innerText = t.viewList;
            document.getElementById('btnAddProd').innerText = t.addProd;
            document.getElementById('dbName').placeholder = t.prodPh;
            document.getElementById('dbPrice').placeholder = t.pricePh;
            document.getElementById('btnSaveDB').innerText = t.saveDB;
            document.getElementById('txtNote').innerText = t.note;

            // ‡¶°‡ßç‡¶∞‡¶™‡¶°‡¶æ‡¶â‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
            const sel = document.getElementById('dbUnit');
            sel.innerHTML = '';
            t.units.forEach(u => {
                let op = document.createElement('option');
                op.value = u; op.innerText = u;
                sel.appendChild(op);
            });

            // ‡¶Æ‡ßá‡¶Æ‡ßã
            document.getElementById('txtBism').innerText = t.bism;
            document.getElementById('lblMemoNo').innerText = t.memoNo;
            document.getElementById('lblDate').innerText = t.date;
            document.getElementById('lblCustName').innerText = t.custName;
            document.getElementById('inpCustName').placeholder = t.custPh;

            document.getElementById('thDesc').innerText = t.desc;
            document.getElementById('thQty').innerText = t.qty;
            document.getElementById('thUnit').innerText = t.unit;
            document.getElementById('thRate').innerText = t.rate;
            document.getElementById('thTotal').innerText = t.total;

            document.getElementById('lblWords').innerText = t.words;
            document.getElementById('lblSign').innerText = t.sign;
            document.getElementById('lblTotal').innerText = t.totalLbl;
            document.getElementById('lblPaid').innerText = t.paid;
            document.getElementById('lblDue').innerText = t.due;
            document.getElementById('txtFooterMsg').innerText = t.footerMsg;

            document.getElementById('btnWeb').innerText = t.btnWeb;
            document.getElementById('btnGal').innerText = t.btnGal;
            document.getElementById('btnNew').innerText = t.btnNew;
            
            // ‡¶π‡ßá‡¶°‡¶æ‡¶∞‡¶ó‡ßÅ‡¶≤‡ßã ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ö‡ßá‡¶û‡ßç‡¶ú ‡¶π‡¶¨‡ßá, ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶π‡¶¨‡ßá ‡¶®‡¶æ
            if(document.getElementById('txtShopName').innerText.includes('HEADLINE') || document.getElementById('txtShopName').innerText.includes('‡¶π‡ßá‡¶°‡¶≤‡¶æ‡¶á‡¶®')) {
                 document.getElementById('txtShopName').innerText = t.shopName;
            }
        }


        // ---- ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞ ----
        const canvas = document.getElementById('signCanvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;

        canvas.addEventListener('mousedown', () => drawing = true);
        canvas.addEventListener('mouseup', () => { drawing = false; ctx.beginPath(); });
        canvas.addEventListener('mousemove', draw);
        
        canvas.addEventListener('touchstart', (e) => { drawing = true; e.preventDefault(); });
        canvas.addEventListener('touchend', (e) => { drawing = false; ctx.beginPath(); e.preventDefault(); });
        canvas.addEventListener('touchmove', drawTouch);

        function draw(e) {
            if (!drawing) return;
            ctx.lineWidth = 2; ctx.lineCap = 'round'; ctx.strokeStyle = '#000';
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke(); ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }
        function drawTouch(e) {
            if (!drawing) return;
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            ctx.lineWidth = 2; ctx.lineCap = 'round'; ctx.strokeStyle = '#000';
            ctx.lineTo(touch.clientX - rect.left, touch.clientY - rect.top);
            ctx.stroke(); ctx.beginPath();
            ctx.moveTo(touch.clientX - rect.left, touch.clientY - rect.top);
        }
        function clearSignature() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

        // ---- ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ----
        const defaultBanners = [
            "https://i.ibb.co/wFDBHjZs/1000025987.jpg",
            "https://i.ibb.co/jPcMDZhT/1000026069.jpg",
            "https://i.ibb.co/277Jb56B/1000026072.jpg"
        ];
        function loadBanners() {
            let saved = JSON.parse(localStorage.getItem('mk_banners')) || defaultBanners;
            document.getElementById('slide1').src = saved[0];
            document.getElementById('slide2').src = saved[1];
            document.getElementById('slide3').src = saved[2];
            document.getElementById('url1').value = saved[0];
            document.getElementById('url2').value = saved[1];
            document.getElementById('url3').value = saved[2];
        }
        function toggleBannerForm() {
            let f = document.getElementById('bannerForm');
            f.style.display = (f.style.display === 'block') ? 'none' : 'block';
        }
        function saveBanners() {
            let u1 = document.getElementById('url1').value || defaultBanners[0];
            let u2 = document.getElementById('url2').value || defaultBanners[1];
            let u3 = document.getElementById('url3').value || defaultBanners[2];
            localStorage.setItem('mk_banners', JSON.stringify([u1, u2, u3]));
            loadBanners();
            alert(langData[currentLang].alertSave);
            toggleBannerForm();
        }
        let slideIndex = 0;
        const wrapper = document.getElementById('sliderWrapper');
        function startSlider() {
            setInterval(() => {
                slideIndex++;
                if (slideIndex >= 3) { slideIndex = 0; }
                wrapper.style.transform = `translateX(-${slideIndex * 100}%)`;
            }, 3000);
        }
        startSlider();

        // ---- ‡¶Æ‡ßá‡¶á‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï ----
        let db = JSON.parse(localStorage.getItem('mk_smart_db_v1')) || [];
        let savedMemos = JSON.parse(localStorage.getItem('mk_saved_memos_smart')) || [];
        let cart = [];
        let delMode = false;

        window.onload = function() {
            setLang('bn'); // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ
            loadBanners();
            loadGrid();
            updateInfo();
            loadHistory();
        };

        function openForm() {
            let f = document.getElementById('inputForm');
            f.style.display = (f.style.display === 'block') ? 'none' : 'block';
        }
        function saveData() {
            let n = document.getElementById('dbName').value;
            let p = document.getElementById('dbPrice').value;
            let u = document.getElementById('dbUnit').value;
            if(!n || !p) return alert('Error');
            db.push({ name: n, price: p, unit: u });
            localStorage.setItem('mk_smart_db_v1', JSON.stringify(db));
            loadGrid();
            document.getElementById('dbName').value = '';
            document.getElementById('dbPrice').value = '';
            openForm();
        }
        function loadGrid() {
            let g = document.getElementById('gridArea');
            g.innerHTML = '';
            if(db.length === 0) g.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#777;">...</div>';
            db.forEach((i, idx) => {
                let div = document.createElement('div');
                div.className = 'item-box';
                div.innerHTML = `<div class="del-badge" onclick="remDB(event, ${idx})">X</div>
                                 <span class="item-name">${i.name}</span>
                                 <span class="item-price">${i.price}</span>`;
                div.onclick = (e) => { if(!e.target.classList.contains('del-badge')) addToCart(idx); };
                g.appendChild(div);
            });
            document.querySelectorAll('.del-badge').forEach(b => b.style.display = delMode ? 'block' : 'none');
        }
        function toggleDel() { delMode = !delMode; loadGrid(); }
        function remDB(e, i) {
            e.stopPropagation();
            if(confirm(langData[currentLang].confirmDel)) {
                db.splice(i, 1);
                localStorage.setItem('mk_smart_db_v1', JSON.stringify(db));
                loadGrid();
            }
        }

        function addToCart(idx) {
            let item = db[idx];
            let q = prompt(langData[currentLang].promptQty, 1);
            if(q && q > 0) {
                let quantity = parseFloat(q);
                let totalPrice = 0;
                // ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶∂‡¶®
                if (['‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ', '‡¶Æ‡¶ø‡¶≤‡¶ø', 'Gm', 'Ml'].includes(item.unit)) {
                    totalPrice = (item.price / 1000) * quantity;
                } else {
                    totalPrice = item.price * quantity;
                }
                cart.push({ name: item.name, unit: item.unit, qty: quantity, price: item.price, total: totalPrice });
                render();
            }
        }

        function render() {
            let tb = document.getElementById('tbody');
            tb.innerHTML = '';
            let gt = 0;
            cart.forEach((c, i) => {
                gt += c.total;
                tb.innerHTML += `
                <tr onclick="askRem(${i})">
                    <td class="col-desc">${c.name}</td>
                    <td class="col-qty">${c.qty}</td>
                    <td>${c.unit}</td>
                    <td class="col-rate">${c.price}</td>
                    <td class="col-total">${c.total.toFixed(2)}</td>
                </tr>`;
            });
            for(let j=cart.length; j<5; j++) {
                tb.innerHTML += `<tr><td class="col-desc">&nbsp;</td><td></td><td></td><td class="col-rate"></td><td class="col-total"></td></tr>`;
            }
            document.getElementById('grandTotal').innerText = gt.toFixed(2);
        }

        function askRem(i) { if(confirm(langData[currentLang].confirmDel)) { cart.splice(i, 1); render(); } }

        function updateInfo() {
            const d = new Date();
            document.getElementById('mDate').innerText = d.toLocaleDateString('bn-BD');
            document.getElementById('mNo').innerText = Math.floor(1000 + Math.random() * 9000);
        }
        function resetMemo() {
            if(confirm('Reset?')) {
                cart = []; 
                document.getElementById('tablePaid').value = '';
                document.getElementById('tableDue').value = '';
                clearSignature(); 
                render(); 
                updateInfo();
                document.querySelector('.cust-input').value = '';
            }
        }
        function saveToWebsite() {
            if(cart.length === 0) return alert(langData[currentLang].alertEmpty);
            let memoData = {
                no: document.getElementById('mNo').innerText,
                date: document.getElementById('mDate').innerText,
                cust: document.querySelector('.cust-input').value || '-',
                items: cart,
                total: document.getElementById('grandTotal').innerText
            };
            savedMemos.push(memoData);
            localStorage.setItem('mk_saved_memos_smart', JSON.stringify(savedMemos));
            alert(langData[currentLang].alertSave);
            loadHistory();
        }
        function toggleSavedList() {
            let area = document.getElementById('savedListArea');
            area.style.display = (area.style.display === 'block') ? 'none' : 'block';
        }
        function loadHistory() {
            let container = document.getElementById('historyContainer');
            container.innerHTML = '';
            if(savedMemos.length === 0) return container.innerHTML = '<p style="text-align:center;color:#777;">...</p>';
            savedMemos.slice().reverse().forEach((m, i) => {
                let originalIndex = savedMemos.length - 1 - i;
                let div = document.createElement('div');
                div.className = 'saved-item';
                div.innerHTML = `
                    <div onclick="restoreMemo(${originalIndex})" style="flex-grow:1;">
                        <strong>#${m.no}</strong> - ${m.cust}<br>
                        <small>${m.date} | Total: ${m.total}</small>
                    </div>
                    <button onclick="deleteHistory(${originalIndex})" style="background:red;color:white;border:none;padding:5px;">X</button>
                `;
                container.appendChild(div);
            });
        }
        function restoreMemo(idx) {
            let m = savedMemos[idx];
            document.getElementById('mNo').innerText = m.no;
            document.getElementById('mDate').innerText = m.date;
            document.querySelector('.cust-input').value = m.cust;
            cart = m.items || [];
            render();
            document.getElementById('savedListArea').style.display = 'none';
        }
        function deleteHistory(idx) {
            if(confirm(langData[currentLang].confirmDel)) {
                savedMemos.splice(idx, 1);
                localStorage.setItem('mk_saved_memos_smart', JSON.stringify(savedMemos));
                loadHistory();
            }
        }
        
        function downloadImage() {
            const element = document.getElementById('printArea');
            fixInputs(element);
            html2canvas(element, { scale: 3, useCORS: true }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'Memo.jpg';
                link.href = canvas.toDataURL('image/jpeg', 1.0);
                link.click();
            });
        }

        async function downloadPDF() {
            const element = document.getElementById('printArea');
            fixInputs(element);
            const canvas = await html2canvas(element, { scale: 2, useCORS: true, scrollY: 0, height: element.scrollHeight, windowHeight: element.scrollHeight });
            const imgData = canvas.toDataURL('image/png');
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', [(canvas.height * 210) / canvas.width, 210]); 
            pdf.addImage(imgData, 'PNG', 0, 0, 210, (canvas.height * 210) / canvas.width);
            pdf.save('Memo.pdf');
        }

        function fixInputs(el) {
            const inputs = el.querySelectorAll('input');
            inputs.forEach(inp => inp.setAttribute('value', inp.value));
        }
    </script>
</body>

</html>
